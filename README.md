# BUAA-CO-2020
**北航计组实验课下测试代码2020**

**WARNING：课下代码仅保证能通过2020秋课上强测，不保证完全不存在问题**

**HINT：请务必自行进行测试点构造及课下测试，据不可靠消息，课下弱测≈编译通过，课下中强测≈弱测**

## 课下测试设计要求

### P0

#### Q1.CRC校验

使用Logisim搭建一个除数为四位，原数据帧为8位的CRC校验码计算电路。

#### Q2.实现GRF

使用logisim搭建一个GRF。GRF中包含32个32位寄存器，分别对应0~31号寄存器，其中0号寄存器读取的结果恒为0。

#### Q3.Logisim导航

计小组要去机房上机考试，需要去B机房，但是目前他在A机房。他现在的时间很充裕，就决定生成一串随机序列，告诉他下一步行走的方向，直到走到B机房。他希望用logisim搭建一个可以导航的Moore型有限状态机，来通过序列告诉他是否到达B机房。

计小组只能往东南西北四个方向行走，且若能行走，则每次只能行走一格。若下一步不存在机房让计小组行走，那么计小组会撞到墙壁并且hit置高一周期，此时计小组仍保持原地不会移动，等待下一周期再进行运动。（如果下一步依旧撞墙， 则hit仍然置高；若下一步不会撞墙，则计小组将会继续行进，hit在此周期置0）

计小组走到B机房后，“到达”信号需要置位，并保持一周期。到达B机房后计小组将会在下一周期回到原点，（下一周期的输入将被忽略掉）等待下下周期的输入，继续测试他的序列。

计小组遵循上北下南左西右东的方向完成操作。

计小组在时钟上升沿的时候就已经知道自己下一步的方向并且瞬移过去，并且立即做出判断。

#### Q4.Logisim中的FSM

使用Logisim搭建一个Mealy型有限状态机 检测串行输入字符串中的能匹配正则表达式b{1,2}[ac]{2}的子串并输出。

#### 附加题.ftoi

使用Logisim进行组合逻辑设计，要求输入一个16位的单精度浮点数（符合IEEE-754标准），输出该浮点数的整数部分(包含符号)，用32位二进制符号数表示。

### P1

#### Q1.Verilog实现splitter

使用 Verilog 搭建一个32位 Splitter , 给定一个32位的二进制数作为输入，将其划分为四个8位的二进制数作为输出。

#### Q2.Verilog实现ALU

使用 Verilog 搭建一个 32 位六运算 ALU （加、减、与、或、逻辑右移、算术右移）。

#### Q3.Verilog实现EXT

EXT为扩展单元，其主要功能是完成将输入到其中的16位数据进行符号扩展、零扩展以及将输入的16位数加载到高位等操作。

#### Q4.格雷码计数器

实现如下功能：

1、 在任意一个时钟上升沿到来的时候，如果复位信号有效，则将计数器清零；

2、 每个时钟上升沿到来的时候，如果使能信号有效，计数器的值+1；

3、 在满足1时，即使2的条件满足，也不必执行2；

4、 计数器初值为0；

5、 当计数器的值在+1后出现溢出的情况时，将会回到零，同时从发生溢出的这个时钟上升沿开始，溢出标志位将会持续输出1，直到计数器被清零为止（其余情况下溢出标志位必须为0）。

#### Q5.表达式状态机

计算机经常用于处理关于表达式的问题。现在有这样一类表达式F的字符串需要你来验证它们的合法性：

1、表达式F中只含有数字0-9，加号+，乘号*。

2、表达式F可以按如下的规则产生：

a. 单个数字[0-9]是F；

b. 如果X是F，Y是F，X+Y也是F；

c. 如果X是F，Y是F，X*Y也是F。

每个时钟上升沿，状态机从 in 中读入一个ASCII编码的字符。假设读入的第i个字符为ci，则第n个时钟上升沿时，可以拼出一个字符串: s = c1c2……cn

我们需要你在此时判断 s 是否符合表达式F的定义。假如s符合F的定义，那么 out 应输出1，否则输出0。

另外，每个 clr 上升沿时，请清零状态；如果 clk 的上升沿时 clr 为 1，也需要清零状态。清零后，上面定义的字符串也应从空串开始计算。如果当前是空串，out也应输出0。

注意，我们不需要你分析表达式的语法和语义，只要判断形式上合法性就可以正确求解。

### P2

#### Q1.矩阵乘法

首先读取方形矩阵的阶数n，然后再依次读取第一个矩阵（n行n列）和第二个矩阵（n行n列）中的元素。

两个矩阵的阶数相同，我们提供的测试数据中0<n≤8,每个矩阵元素小于10。

最终将计算出的结果输出，每行n个数据，每个数据间用空格分开。评测机会自动过滤掉行尾空格以及最后的回车。

请使用syscall结束程序。

#### Q2.回文串判断

判断输入的字符串是不是回文串。

输出一个字符，是回文串输出1，否则输出0。

每组数据最多执行100,000条指令。

请使用syscall结束程序。

#### Q3.卷积运算

首先读取待卷积矩阵的行数m1和列数n1，然后读取卷积核的行数m2和列数n2。

然后再依次读取待卷积矩阵(m1行n1列)和卷积核(m2行n2列)中的元素。

卷积核的行列数分别严格小于待卷积矩阵的行列数。

测试数据中0<m1, n1, m2, n2 <11。

输入的每个数的绝对值不超过2^10。

最终输出进行卷积后的结果。

输出中，有m1-m2+1行，每行有n1-n2+1个数据，每个数据用空格分开。

请使用syscall结束程序。

#### Q4.全排列

使用mips实现全排列生成算法。

以0x00000000为数据段起始地址。

输入一个小于等于6的正整数，求出n的全排列，并按照字典序输出。

每组数据最多执行500,000条指令。

请使用syscall结束程序。

#### 附加1.01迷宫

使用深度优先探索算法求解01迷宫的逃离路线个数。

以红色0作为起点，绿色0作为终点，每一次行进只能选择上下左右中值为0且未走过的位置，满足上述条件的路线，即为一条迷宫逃跑路线。

每组数据最多执行5,000,000条指令。

#### 附加2.高精度阶乘

使用MIPS汇编语言编写一个求n的阶乘的汇编程序(不考虑延迟槽)。

### P3

处理器为32位处理器。

处理器应支持的指令集为：{addu, subu, ori, lw, sw, beq, lui, nop}。

nop机器码为0x00000000， 即空指令，不进行任何有效行为（修改寄存器等）。

addu, subu可以不支持溢出。

处理器为单周期设计。

需要采用模块化和层次化设计。顶层有效的驱动信号要求包括且仅包括：reset (clk 请使用内置时钟模块)。

需自行构造测试集，验证设计的正确性（通过课下自动测试并不意味着你的设计完全不存在问题）。

### P4

处理器应支持指令集为：{addu, subu, ori, lw, sw, beq, lui, jal, jr,nop}。

addu, subu可以不支持溢出。

处理器为单周期设计。

不需要考虑延迟槽。

支持同步复位。

需自行构造测试集，验证设计的正确性。（通过课下自动测试并不意味着你的设计完全不存在问题）。

下列模块必须严格满足如下的接口定义：

module mips{clk, reset};

input clk;

input reset;

必须在Verilog HDL设计中建立这个顶层模块，不允许修改模块名称、端口各信号以及变量的名称/类型。

在grf模块中，每个时钟上升沿到来时若要写入数据(即写使能信号为1且非reset时)则输出写入的位置及写入的值，格式为

$display("@%h: $%d <= %h", WPC, Waddr, WData);

请注意空格。其中WPC表示相应指令的储存地址，从0x0000_3000开始；Waddr表示输入的5位写寄存器的地址；WData表示输入的32位写入寄存器的值。

例如，地址在0x0000_3000的指令向3号寄存器写入数据0，则应该输出"@00003000: $3 <= 00000000"，其中00003000应该是对应操作的指令的 16 位进制地址， 不足 8 位需要补零。

在dm模块中，每个时钟上升沿到来时若要写入数据(即写使能信号为1且非reset时)则输出写入的位置及写入的值，格式为

$display("@%h: *%h <= %h", pc, addr, din);

请注意空格。其中pc是该操作对应的指令的地址，和grf模块要求一致，addr表示将要存入数据的32位地址，din表示输入的32位写入dm的值。

例如，若地址在0x0000_3004的指令要在0x00001004地址写入数据0，则应该输出"@00003004: *00001004 <= 00000000"

复位后，PC指向0x0000_3000，此处为第一条指令的地址，GRF和DM中的所有数据清零。注意与MARS中的设置保持一致。若在复位期间对存储单元进行了复位操作请不要输出任何信息，以免影响评测结果。

所有指令均以指令集规定的行为为准，可参看MIPS-C指令集（该指令集描述针对单周期，注意单周期和流水线有些许指令行为描述不同，但最终结果是一致的，程序运行的最终结果应与MARS保持一致）。

### P5

处理器应支持MIPS-lite2指令集。

MIPS-lite2={ addu, subu, ori, lw, sw, beq, lui, j, jal, jr, nop }。

处理器为五级流水线设计。

流水线的设计以追求性能为第一目标，因此必须尽最大可能支持转发以解决数据冒险。这一点在本project的最终成绩中所占比重较大，课上测试时会通过测试程序所运行的总周期数进行判定，望大家慎重对待。

对于 b 类和 j 类指令， 流水线设计必须支持延迟槽，因此设计需要注意使用 PC@D+8或PC@I+4。

为了解决数据冒险而设计的转发数据来源必须是某级流水线寄存器，不允许对功能部件的输出直接进行转发。

指令存储器(IM，instruction memory)和数据存储器(DM，data memory)要求如下：

IM：容量为4KB(32bit/word×1024word)。

DM：容量为4KB(32bit/word×1024word)。

PC的初始地址为0x0000_3000，和Mars中我们要求设置的代码初始地址相同。

### P6

处理器应支持MIPS-C3指令集。

MIPS-C3={LB、LBU、LH、LHU、LW、SB、SH、SW、ADD、ADDU、SUB、 SUBU、 MULT、 MULTU、 DIV、 DIVU、 SLL、 SRL、 SRA、 SLLV、SRLV、SRAV、AND、OR、XOR、NOR、ADDI、ADDIU、ANDI、ORI、XORI、LUI、SLT、SLTI、SLTIU、SLTU、BEQ、BNE、BLEZ、BGTZ、BLTZ、BGEZ、J、JAL、JALR、JR、MFHI、MFLO、MTHI、MTLO}

所有运算类指令均暂不考虑因溢出而产生的异常。

处理器为五级流水线设计。

指令存储器(IM，instruction memory)和数据存储器(DM，data memory)要求如下：

IM：容量为16KB(32bit/word×4096word)。

DM：容量为16KB(32bit/word×4096word)。

乘除法运算延迟。我们假定乘/除部件的执行乘法的时间为5个cycle(包含写入内部的HI和LO寄存器)，执行除法的时间为10个cycle。你在乘/除部件内部必须模拟这个延迟，即通过Busy输出标志来反映这个延迟。同时我们通过只能有效1个cycle的Start信号来启动乘除法运算。

乘除模块行为约定如下：

自 Start 信号有效后的第 1 个 clock 上升沿开始，乘除部件开始执行运算，同时 Busy 置位为 1。

在运算结果保存到 HI 和 LO 后，Busy 位清除为 0。

当 Busy 为 1 时，mfhi、mflo、mthi、mtlo、mult、multu、div、divu 均被阻塞，即被阻塞在 IF/ID。

数据写入 HI 或 LO，均只需 1 个 cycle。

### P7

添加新部件Bridge、CP0，支持I/O设备、精确中断与精确异常。
